# GMR Mosaic AI Demo - Model Serving Endpoint Configuration

resources:
  model_serving_endpoints:
    gmr_royalty_agent:
      name: "gmr-royalty-agent-${bundle.target}"
      config:
        served_entities:
          - entity_name: "${var.catalog}.${var.schema}.gmr_royalty_agent"
            entity_version: "1"
            workload_size: "Small"
            scale_to_zero_enabled: true
        auto_capture_config:
          catalog_name: "${var.catalog}"
          schema_name: "${var.schema}"
          table_name_prefix: "agent_inference"
          enabled: true
        traffic_config:
          routes:
            - served_model_name: "gmr_royalty_agent-1"
              traffic_percentage: 100
        rate_limits:
          - calls: 10
            key: user
            renewal_period: MINUTE
          - calls: 100
            key: endpoint
            renewal_period: MINUTE
      ai_gateway:
        guardrails:
          input:
            # Block off-topic queries
            invalid_keywords:
              - "write me a poem"
              - "what's the weather"
              - "tell me a joke"
            safety: true
            pii:
              behavior: BLOCK
          output:
            # Block PII in responses
            pii:
              behavior: BLOCK
            # Block competitor-specific rate information
            invalid_keywords:
              - "ASCAP rate schedule"
              - "BMI fee structure"
              - "SESAC pricing"
            safety: true
        usage_tracking_config:
          enabled: true
